// ==UserScript==
// @name         GoodData | better Workkflow
// @namespace    https://github.com/vojtaflorian
// @version      2025-02-03
// @description  GoodData | better Workkflow
// @author       Vojta Florian
// @include      *https://bootiq.na.gooddata.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=bootiq.na.gooddata.com
// @downloadURL  https://raw.githubusercontent.com/vojtaflorian/userscript-mpx/refs/heads/main/megapixel-pdp-edit
// @updateURL    https://raw.githubusercontent.com/vojtaflorian/userscript-mpx/refs/heads/main/megapixel-pdp-edit
// @grant        none
// ==/UserScript==


(function () {
    'use strict';
    console.log("GoodData | better Workkflow: Aktuální URL: " + window.location.href);

    //************************** ÚPRAVA STYLŮ A FORMÁTOVÁNÍ PDP ***************************
    // Vytvoření nového style elementu a přidání více CSS pravidel
    var style = document.createElement('style');
    style.type = 'text/css';
    style.innerHTML = `
    .width-50 { width: 50% !important; }
    .hidden {display: none;}
    .max-width-90px { max-width: 90px; word-wrap: break-word; white-space: normal !important;}
    .table-small { display: flex; overflow-x: auto;}

.datagrid table th.col-action{text-align:center}.datagrid table td.col-action,.datagrid table th.col-action {white-space:nowrap;width:10px;padding-right:10px;}
@supports (position:sticky) {

		.datagrid table .col-action { position:sticky; right:0px; z-index:1; }
		.datagrid table th.col-action { background:#cacaca; }
		.datagrid table td.col-action { background:#d8d8d8; }
		.datagrid table tr:nth-child(even) td.col-action { background:#e5e5e5; }

		.datagrid table .col-action:before { position:absolute; top:0; left:-25px; bottom:-1px; width:25px; background:linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,.2)); opacity:0; content:""; transition:opacity 300ms ease; transform:translateZ(0); pointer-events:none; }
		.datagrid.is-stuck-col-action table .col-action:before { opacity:1; }

	}


    `;
    document.getElementsByTagName('head')[0].appendChild(style);
    console.log('GoodData | better Workkflow: Vytvořené nové styly pro další aplikace');

    // Seznam ID pro aplikování třídy table-overflow
    //   var ids = ['snippet-ordersGrid-table'];

    var idToClassMap = {
        'snippet-ordersGrid-grid': 'table-small',
        'snippet-orderEShopGrid-grid': 'table-small',
        'snippet-codesGrid-grid': 'table-small',
        'frm-orderEShopGrid-filter-filter-abraID':'max-width-90px',
        'frm-orderEShopGrid-filter-filter-order_no':'max-width-90px',
        'frm-orderEShopGrid-filter-filter-created-from':'max-width-90px',
        'frm-orderEShopGrid-filter-filter-created-to':'max-width-90px'
    };

    Object.keys(idToClassMap).forEach(function(id) {
        var element = document.getElementById(id);
        var className = idToClassMap[id];
        if (element) {
            element.classList.add(className);
        }
    });
    var classToAddMap = {
        'grid-q col-q-1': {className: 'width-50', url: 'https://www.megapixel.cz/pdp/page/edit-attached/'}, //stránky - připojený obsah, změna šířky input boxu
        'col-id': {className: 'hidden', url: ''}, //sloupce pro tabulku objednavek
        'col-order_no': {className: 'max-width-90px', url: ''},
        'col-created': {className: 'max-width-90px', url: ''},
        'col-abraID': {className: 'max-width-90px', url: ''},
        'col-status': {className: 'max-width-90px', url: ''},
        'col-affiliateUser': {className: 'hidden', url: ''}
    };

    Object.keys(classToAddMap).forEach(function(originalClass) {
        var config = classToAddMap[originalClass];
        // Pokud není zadána URL nebo aktuální URL obsahuje zadanou URL
        if (!config.url || window.location.href.includes(config.url)) {
            var elements = document.getElementsByClassName(originalClass);
            for (var i = 0; i < elements.length; i++) {
                elements[i].classList.add(config.className);
            }
        }
    });

    console.log('GoodData | better Workkflow: Přidány třídy k prvkům.');


})();
